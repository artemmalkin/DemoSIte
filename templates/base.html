<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href={{ url_for('static', filename='css/style.css') }}/>
    <title>{{ title }}</title>

    <script src={{ url_for('static', filename='javascript/config.js') }}></script>
    <script src={{ url_for('static', filename='javascript/chat_config.js') }}></script>
    <script type="text/javascript">url_for_icons = "{{ url_for('static', filename='icons') }}"</script>
</head>

<body>
<header>

    <div class="menu-main">
        <div class="button-header"><a href={{ url_for('index') }}>Главная</a></div>
        {% if current_user.is_authenticated %}
            <div class="button-header"><a href={{ url_for('chat.index') }}>Чат</a></div>
        {% endif %}
    </div>

    <div class="title">Demo Website</div>

    <div class="menu-auth" id="menu-auth">
        {% if current_user.is_authenticated %}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
                    integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
                    crossorigin="anonymous">
            </script>
            <script src={{ url_for('static', filename='javascript/navigation.js') }}></script>
            <script type="text/javascript">
                let socket = io();
                const me = {{ current_user.id }};

                socket.on('connect', function () {
                    socket.emit('join');
                });

                socket.on('received_message', function (data) {
                    if (data.sender.id !== me && data.chat_id !== current_chat_id) {
                        updateNotifications()

                        let show = true
                        let interval_id = setInterval(function () {
                            if (show) {
                                document.title = 'Новое уведомление!'
                                show = false
                            } else {
                                document.title = title
                                show = true
                            }
                        }, 500)
                        setTimeout(function () {
                            clearInterval(interval_id)
                        }, 5500)
                    } else {
                        socket.emit('chat is read', {chat_id: current_chat_id})
                    }
                })
            </script>
            <div class="button-ico" id="notification">
                <img alt="notification icon" id="notification-icon" src="{{ url_for('static', filename='icons/notification.svg') }}">
                <div class="notification-count" id="notification-count"></div>
            </div>

            <div class="notification-menu" id="notification-menu">
                <svg id="ntf-mn-arrow" height="1em" width="1em">
                    <rect x="0" y="0" width="30" height="30" fill="white"></rect>
                </svg>
                <div class="notification-list" id="notification-list"></div>
            </div>

            <a class="avatar"
               href={{ url_for('profile', user_id=current_user.id) }}>{{ current_user.login.upper()[0] }}</a>
            <div class="button-header"><a href={{ url_for('logout') }}>Выйти</a></div>

        {% else %}
            <div class="button-header"><a href={{ url_for('login') }}>Вход</a></div>
            <div class="button-header"><a href={{ url_for('register') }}>Регистрация</a></div>
        {% endif %}
    </div>
</header>

<div class="left-content">
    {% block left_content %}
    {% endblock left_content %}
</div>

<div class="content">
    {% block content %}
    {% endblock content %}
</div>

<div class="right-content">
    {% block right_content %}
    {% endblock right_content %}
</div>
</body>
</html>